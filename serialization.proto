package com.memstore;

option java_package = "com.memstore.serialization";

message Data {

	repeated Entities entities = 1;

	message Entities {
		required string name = 1;
		repeated Entity entity = 2;
	}
	
	message Entity {
		required uint64 date = 1;
		repeated StringTuple strings = 2;
		repeated IntTuple integers = 3;
		optional bool tombstone = 4;
	}
	
	message StringTuple {
		required string key = 1;
		required string value = 2;
	}
	
	message IntTuple {
		required string key = 1;
		required uint32 value = 2;
	}
}

message PBEntity {
	required uint32 entityId = 1;
	required uint32 bitmap = 2;
	repeated uint32 poolIndexes = 3;
}

message PBEntityManager {
	repeated PBEntityData entityData = 1;
}

message PBEntityData {
	required string name = 1;
	required string keyColumn = 2;
	repeated PBValue primaryIndexKey = 3;
	repeated PBEntityTimeline entityTimeline= 4;
	//todo indexes
}

message PBEntityTimeline {
	repeated uint64 date = 1;
	repeated PBEntityTimelineValue value = 2;
}

message PBEntityTimelineValue {
	optional Tombstone tombstone = 1;
	optional PBEntity entity = 2;
}

message Tombstone{}

message PBValue {
	optional string string = 1;
	optional int32 int = 2;
	optional int64 long = 3;
}